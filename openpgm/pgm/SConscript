# -*- mode: python -*-
# OpenPGM build script
# $Id$

EnsureSConsVersion( 0, 96 )

import os
Import('env')

SConsignFile('scons.signatures')


httpenv = env.Copy()
httpenv.ParseConfig('pkg-config --cflags --libs glib-2.0 gthread-2.0 libsoup-2.2')

env.ParseConfig('pkg-config --cflags --libs glib-2.0 gthread-2.0')

shared_src = Split("""
		log.c
		pgm.c
		backtrace.c
		timer.c
		if.c
		gsi.c
""")

# Basic versions
txw_obj = env.Object('txw.c')
rxw_obj = env.Object('rxw.c')

# Inlined versions
txwi_obj = env.Object('txwi.c')
rxwi_obj = env.Object('rxwi.c')

transport_obj = env.Object('transport.c')

shared_obj = []
for src in shared_src:
	shared_obj += env.Object(src)

standard_obj = shared_obj + txwi_obj + rxwi_obj + transport_obj

env.Program(['pgmdump.c'] + shared_obj)
env.Program(['basic_send.c'] + shared_obj)
env.Program(['spm_idle.c'] + shared_obj)
env.Program(['stream_send.c'] + shared_obj)
httpenv.Program(['basic_recv.c'] + shared_obj)
httpenv.Program(['basic_http.c'] + shared_obj)
env.Program(['basic_container.c'])
env.Program(['basic_container2.c'])
env.Program(['basic_txw.c'] + txwi_obj)
env.Program('basic_txw_byte', ['basic_txw.c', 'txw-byte.c'])
env.Program('basic_txw_bytep', ['basic_txw.c', 'txw-bytep.c'])
env.Program(['nak_txw.c'] + txw_obj)
env.Program(['stream_send_with_nak.c'] + shared_obj + txw_obj)
httpenv.Program(['basic_recv_with_nak.c'] + shared_obj)
env.Program(['dumpif.c'] + shared_obj)
env.Program(['testif.c'] + shared_obj)
env.Program('sw_calc.c')
httpenv.Program(['basic_recv_with_rxw.c'] + shared_obj + rxw_obj)
env.Program(['basic_rxw.c'] + shared_obj + rxwi_obj)
env.Program('test_cpu_timers.c')
env.Program(['test_time.c'] + shared_obj)

env.Program(['pgmsend.c'] + standard_obj)

# end of file
